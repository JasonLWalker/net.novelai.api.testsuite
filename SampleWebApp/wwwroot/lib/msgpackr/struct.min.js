/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/msgpackr@1.10.1/struct.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{setWriteStructSlots,RECORD_SYMBOL,addExtension}from"./pack.js";import{setReadStruct,mult10,readString}from"./unpack.js";const ASCII=3,NUMBER=0,UTF8=2,OBJECT_DATA=1,DATE=16,TYPE_NAMES=["num","object","string","ascii"];TYPE_NAMES[16]="date";const float32Headers=[!1,!0,!0,!1,!1,!0,!0,!1];let evalSupported,updatedPosition;try{new Function(""),evalSupported=!0}catch(t){}const hasNodeBuffer="undefined"!=typeof Buffer;let textEncoder,currentSource;try{textEncoder=new TextEncoder}catch(t){}const encodeUtf8=hasNodeBuffer?function(t,e,n){return t.utf8Write(e,n,4294967295)}:!(!textEncoder||!textEncoder.encodeInto)&&function(t,e,n){return textEncoder.encodeInto(e,t.subarray(n)).written},TYPE=Symbol("type"),PARENT=Symbol("parent");function writeStruct(t,e,n,r,s,a,i,u){let o=u.typedStructs||(u.typedStructs=[]),c=e.dataView,l=(o.lastStringStart||100)+r,f=e.length-10,p=r;r>f&&(c=(e=a(r)).dataView,r-=n,p-=n,l-=n,n=0,f=e.length-10);let y,d=l,b=o.transitions||(o.transitions=Object.create(null)),S=o.nextId||o.length,g=S<15?1:S<240?2:S<61440?3:S<15728640?4:0;if(0===g)return 0;r+=g;let h,m=[],w=0;for(let s in t){let u=t[s],g=b[s];switch(g||(b[s]=g={key:s,parent:b,enumerationOffset:0,ascii0:null,ascii8:null,num8:null,string16:null,object16:null,num32:null,float64:null,date64:null}),r>f&&(c=(e=a(r)).dataView,r-=n,p-=n,l-=n,d-=n,n=0,f=e.length-10),typeof u){case"number":let t=u;if(S<200||!g.num64){if(t>>0===t&&t<536870912&&t>-520093696){t<246&&t>=0&&(g.num8&&!(S>200&&g.num32)||t<32&&!g.num32)?(b=g.num8||createTypeTransition(g,0,1),e[r++]=t):(b=g.num32||createTypeTransition(g,0,4),c.setUint32(r,t,!0),r+=4);break}if(t<4294967296&&t>=-2147483648&&(c.setFloat32(r,t,!0),float32Headers[e[r+3]>>>5])){let n;if((n=t*mult10[(127&e[r+3])<<1|e[r+2]>>7])>>0===n){b=g.num32||createTypeTransition(g,0,4),r+=4;break}}}b=g.num64||createTypeTransition(g,0,8),c.setFloat64(r,t,!0),r+=8;break;case"string":let T,k=u.length;if(y=d-l,(k<<2)+d>f&&(c=(e=a((k<<2)+d)).dataView,r-=n,p-=n,l-=n,d-=n,n=0,f=e.length-10),k>65280+y>>2){m.push(s,u,r-p);break}let _=d;if(k<64){let t,n,r;for(t=0;t<k;t++)n=u.charCodeAt(t),n<128?e[d++]=n:n<2048?(T=!0,e[d++]=n>>6|192,e[d++]=63&n|128):55296==(64512&n)&&56320==(64512&(r=u.charCodeAt(t+1)))?(T=!0,n=65536+((1023&n)<<10)+(1023&r),t++,e[d++]=n>>18|240,e[d++]=n>>12&63|128,e[d++]=n>>6&63|128,e[d++]=63&n|128):(T=!0,e[d++]=n>>12|224,e[d++]=n>>6&63|128,e[d++]=63&n|128)}else d+=encodeUtf8(e,u,d),T=d-_>k;if(y<160||y<246&&(g.ascii8||g.string8)){if(T)(b=g.string8)||(o.length>10&&(b=g.ascii8)?(b.__type=2,g.ascii8=null,g.string8=b,i(null,0,!0)):b=createTypeTransition(g,2,1));else{if(0===y&&!h){h=!0,b=g.ascii0||createTypeTransition(g,3,0);break}(b=g.ascii8)||o.length>10&&(b=g.string8)||(b=createTypeTransition(g,3,1))}e[r++]=y}else b=g.string16||createTypeTransition(g,2,2),c.setUint16(r,y,!0),r+=2;break;case"object":if(u){u.constructor===Date?(b=g.date64||createTypeTransition(g,16,8),c.setFloat64(r,u.getTime(),!0),r+=8):m.push(s,u,w);break}g=anyType(g,r,c,-10),g?(b=g,r=updatedPosition):m.push(s,u,w);break;case"boolean":b=g.num8||g.ascii8||createTypeTransition(g,0,1),e[r++]=u?249:248;break;case"undefined":g=anyType(g,r,c,-9),g?(b=g,r=updatedPosition):m.push(s,u,w);break;default:m.push(s,u,w)}w++}for(let t=0,s=m.length;t<s;){let s,a=m[t++],u=m[t++],o=m[t++],f=b[a];if(f||(b[a]=f={key:a,parent:b,enumerationOffset:o-w,ascii0:null,ascii8:null,num8:null,string16:null,object16:null,num32:null,float64:null}),u){let t;y=d-l,y<65280?(b=f.object16,b?t=2:(b=f.object32)?t=4:(b=createTypeTransition(f,1,2),t=2)):(b=f.object32||createTypeTransition(f,1,4),t=4),s=i(u,d),"object"==typeof s?(d=s.position,c=s.targetView,e=s.target,l-=n,r-=n,p-=n,n=0):d=s,2===t?(c.setUint16(r,y,!0),r+=2):(c.setUint32(r,y,!0),r+=4)}else b=f.object16||createTypeTransition(f,1,2),c.setInt16(r,null===u?-10:-9,!0),r+=2;w++}let T=b[RECORD_SYMBOL];if(null==T){T=u.typedStructs.length;let t,e,n=[],r=b;for(;void 0!==(e=r.__type);){let s=r.__size;r=r.__parent,t=r.key;let a=[e,s,t];r.enumerationOffset&&a.push(r.enumerationOffset),n.push(a),r=r.parent}n.reverse(),b[RECORD_SYMBOL]=T,u.typedStructs[T]=n,i(null,0,!0)}switch(g){case 1:if(T>=16)return 0;e[p]=T+32;break;case 2:if(T>=256)return 0;e[p]=56,e[p+1]=T;break;case 3:if(T>=65536)return 0;e[p]=57,c.setUint16(p+1,T,!0);break;case 4:if(T>=16777216)return 0;c.setUint32(p,58+(T<<8),!0)}if(r<l){if(l===d)return r;e.copyWithin(r,l,d),d+=r-l,o.lastStringStart=r-p}else if(r>l)return l===d?r:(o.lastStringStart=r-p,writeStruct(t,e,n,p,s,a,i,u));return d}function anyType(t,e,n,r){let s;return(s=t.ascii8||t.num8)?(n.setInt8(e,r,!0),updatedPosition=e+1,s):(s=t.string16||t.object16)?(n.setInt16(e,r,!0),updatedPosition=e+2,s):(s=t.num32)?(n.setUint32(e,3758096640+r,!0),updatedPosition=e+4,s):(s=t.num64)?(n.setFloat64(e,NaN,!0),n.setInt8(e,r),updatedPosition=e+8,s):void(updatedPosition=e)}function createTypeTransition(t,e,n){let r=TYPE_NAMES[e]+(n<<3),s=t[r]||(t[r]=Object.create(null));return s.__type=e,s.__size=n,s.__parent=t,s}function onLoadedStructures(t){if(!(t instanceof Map))return t;let e=t.get("typed")||[];Object.isFrozen(e)&&(e=e.map((t=>t.slice(0))));let n=t.get("named"),r=Object.create(null);for(let t=0,n=e.length;t<n;t++){let n=e[t],s=r;for(let[t,e,r]of n){let n=s[r];n||(s[r]=n={key:r,parent:s,enumerationOffset:0,ascii0:null,ascii8:null,num8:null,string16:null,object16:null,num32:null,float64:null,date64:null}),s=createTypeTransition(n,t,e)}s[RECORD_SYMBOL]=t}return e.transitions=r,this.typedStructs=e,this.lastTypedStructuresLength=e.length,n}setWriteStructSlots(writeStruct,prepareStructures);var sourceSymbol=Symbol.for("source");function readStruct(t,e,n,r){let s=t[e++]-32;if(s>=24)switch(s){case 24:s=t[e++];break;case 25:s=t[e++]+(t[e++]<<8);break;case 26:s=t[e++]+(t[e++]<<8)+(t[e++]<<16);break;case 27:s=t[e++]+(t[e++]<<8)+(t[e++]<<16)+(t[e++]<<24)}let a=r.typedStructs&&r.typedStructs[s];if(!a){if(t=Uint8Array.prototype.slice.call(t,e,n),n-=e,e=0,r._mergeStructures(r.getStructures()),!r.typedStructs)throw new Error("Could not find any shared typed structures");if(r.lastTypedStructuresLength=r.typedStructs.length,a=r.typedStructs[s],!a)throw new Error("Could not find typed structure "+s)}var i=a.construct;if(!i){var u=(i=a.construct=function(){}).prototype;let t,e=[],n=0;for(let s=0,i=a.length;s<i;s++){let i=a[s],[u,o,c,l]=i;"__proto__"===c&&(c="__proto_");let f,p,y={key:c,offset:n};switch(l?e.splice(s+l,0,y):e.push(y),o){case 0:f=()=>0;break;case 1:f=(t,e)=>{let n=t.bytes[e+y.offset];return n>=246?toConstant(n):n};break;case 2:f=(t,e)=>{let n=t.bytes,r=(n.dataView||(n.dataView=new DataView(n.buffer,n.byteOffset,n.byteLength))).getUint16(e+y.offset,!0);return r>=65280?toConstant(255&r):r};break;case 4:f=(t,e)=>{let n=t.bytes,r=(n.dataView||(n.dataView=new DataView(n.buffer,n.byteOffset,n.byteLength))).getUint32(e+y.offset,!0);return r>=4294967040?toConstant(255&r):r}}switch(y.getRef=f,n+=o,u){case 3:t&&!t.next&&(t.next=y),t=y,y.multiGetCount=0,p=function(t){let e=t.bytes,r=t.position,s=n+r,a=f(t,r);if("number"!=typeof a)return a;let i,u=y.next;for(;u&&(i=u.getRef(t,r),"number"!=typeof i);)i=null,u=u.next;return null==i&&(i=t.bytesEnd-s),t.srcString?t.srcString.slice(a,i):readString(e,a+s,i-a)};break;case 2:case 1:t&&!t.next&&(t.next=y),t=y,p=function(t){let e=t.position,s=n+e,a=f(t,e);if("number"!=typeof a)return a;let i,o=t.bytes,c=y.next;for(;c&&(i=c.getRef(t,e),"number"!=typeof i);)i=null,c=c.next;if(null==i&&(i=t.bytesEnd-s),2===u)return o.toString("utf8",a+s,i+s);currentSource=t;try{return r.unpack(o,{start:a+s,end:i+s})}finally{currentSource=null}};break;case 0:switch(o){case 4:p=function(t){let e=t.bytes,n=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength)),r=t.position+y.offset,s=n.getInt32(r,!0);if(s<536870912){if(s>-520093696)return s;if(s>-536870912)return toConstant(255&s)}let a=n.getFloat32(r,!0),i=mult10[(127&e[r+3])<<1|e[r+2]>>7];return(i*a+(a>0?.5:-.5)>>0)/i};break;case 8:p=function(t){let e=t.bytes,n=(e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))).getFloat64(t.position+y.offset,!0);if(isNaN(n)){let n=e[t.position+y.offset];if(n>=246)return toConstant(n)}return n};break;case 1:p=function(t){let e=t.bytes[t.position+y.offset];return e<246?e:toConstant(e)}}break;case 16:p=function(t){let e=t.bytes,n=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength));return new Date(n.getFloat64(t.position+y.offset,!0))}}y.get=p}if(evalSupported){let t,n=[],s=[],a=0;for(let i of e){if(r.alwaysLazyProperty&&r.alwaysLazyProperty(i.key)){t=!0;continue}Object.defineProperty(u,i.key,{get:withSource(i.get),enumerable:!0});let e="v"+a++;s.push(e),n.push("["+JSON.stringify(i.key)+"]:"+e+"(s)")}t&&n.push("__proto__:this");let i=new Function(...s,"return function(s){return{"+n.join(",")+"}}").apply(null,e.map((t=>t.get)));Object.defineProperty(u,"toJSON",{value(t){return i.call(this,this[sourceSymbol])}})}else Object.defineProperty(u,"toJSON",{value(t){let n={};for(let t=0,r=e.length;t<r;t++){let r=e[t].key;n[r]=this[r]}return n}})}var o=new i;return o[sourceSymbol]={bytes:t,position:e,srcString:"",bytesEnd:n},o}function toConstant(t){switch(t){case 246:return null;case 247:return;case 248:return!1;case 249:return!0}throw new Error("Unknown constant")}function withSource(t){return function(){return t(this[sourceSymbol])}}function saveState(){currentSource&&(currentSource.bytes=Uint8Array.prototype.slice.call(currentSource.bytes,currentSource.position,currentSource.bytesEnd),currentSource.position=0,currentSource.bytesEnd=currentSource.bytes.length)}function prepareStructures(t,e){if(e.typedStructs){let n=new Map;n.set("named",t),n.set("typed",e.typedStructs),t=n}let n=e.lastTypedStructuresLength||0;return t.isCompatible=t=>{let r=!0;if(t instanceof Map){(t.get("named")||[]).length!==(e.lastNamedStructuresLength||0)&&(r=!1),(t.get("typed")||[]).length!==n&&(r=!1)}else(t instanceof Array||Array.isArray(t))&&t.length!==(e.lastNamedStructuresLength||0)&&(r=!1);return r||e._mergeStructures(t),r},e.lastTypedStructuresLength=e.typedStructs&&e.typedStructs.length,t}setReadStruct(readStruct,onLoadedStructures,saveState);
//# sourceMappingURL=/sm/c77d6ca4dd8031d87bafe479de1fbdfcf27ac251d3a2581f1753eabd6c9ded0a.map